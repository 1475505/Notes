# Fault tolerance
- Replica solves fail-stop and faults, but not bug.
> 调试理论：如果我们能判定任意程序状态的正确性，那么给定一个 failure(*可观测*），我们可以通过二分查找定位到第一个 error 的状态，此时的代码就是 fault (bug)。
> 
>![](http://img.070077.xyz//20220926093553.png)



一些细节：
- VMM 作为控制平面，模拟了网络，虚拟机之前是分享以太网资源的（共用 TCP channel，如果接管时返回了两次响应，SEQ 也会被重用，会在 Client 端作为重传 TCP 帧被忽略）。
- 为保持一致性，异步的网络控制默认是关闭的，多核等不确定性状态转换指令也不受支持。
- OUTPUT RULE
![](http://img.070077.xyz//20220918183128.png)
-  TAS（Test-and-Set Server）对共享资源的某个地方设置标识位等，达到类似于“锁”的效果。即 P/B 交互网络断线而与 client 通信的网络正常，为防止发生 split-brain，引入此第三方仲裁决定谁是P。
```c
test-and-set() {
    acquire_lock()
    if flag == true:
      release_lock()
      return false
    else:
      flag = true
      release_lock()
      return true
```